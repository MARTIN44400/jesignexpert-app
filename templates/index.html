{% extends "base.html" %}

{% block title %}Accueil - JeSignExpert{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="bi bi-pen"></i> JeSignExpert - Signature Électronique
        </h1>
    </div>
</div>

<!-- État de la configuration -->
<div class="row mb-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-gear"></i> Configuration
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-6">
                        <strong>URL ECMA :</strong><br>
                        <code>{{ config.base_url }}</code>
                    </div>
                    <div class="col-sm-6">
                        <strong>Shortcut :</strong><br>
                        <code>{{ config.shortcut }}</code>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-sm-6">
                        <strong>Environnement :</strong><br>
                        <span class="badge bg-info">{{ config.environment }}</span>
                    </div>
                    <div class="col-sm-6">
                        <strong>Secret ECMA :</strong><br>
                        {% if secret_configured %}
                            <span class="badge bg-success">Configuré</span>
                        {% else %}
                            <span class="badge bg-danger">Non configuré</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Actions principales -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-lightning"></i> Actions
                </h5>
            </div>
            <div class="card-body">
                {% if not tokens %}
                    <!-- Authentification -->
                    <div class="text-center">
                        <i class="bi bi-shield-lock display-4 text-muted mb-3"></i>
                        <h6 class="text-muted mb-3">Connexion requise</h6>
                        <a href="{{ url_for('authenticate') }}" class="btn btn-success btn-lg w-100">
                            <i class="bi bi-box-arrow-in-right"></i> S'authentifier
                        </a>
                        <small class="text-muted d-block mt-2">Connexion via ComptExpert</small>
                    </div>
                {% else %}
                    <!-- Action principale : Envoi de document -->
                    <div class="text-center">
                        <i class="bi bi-send-fill display-4 text-primary mb-3"></i>
                        <h6 class="mb-3">Prêt à envoyer des documents</h6>
                        <a href="{{ url_for('send_document_page') }}" class="btn btn-success btn-lg w-100 mb-3">
                            <i class="bi bi-send-fill"></i> Envoyer un document
                        </a>
                        <a href="{{ url_for('validate_tokens') }}" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-check-circle"></i> Vérifier la connexion
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if tokens %}
<!-- Informations de connexion -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-person-check"></i> Session active
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <strong>Cabinet :</strong><br>
                        {{ tokens.office.name }}
                        {% if tokens.office.token %}
                            <span class="badge bg-success ms-2">Token valide</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <strong>Utilisateur :</strong><br>
                        {% if tokens.user and tokens.user.email %}
                            {{ tokens.user.email }}
                            {% if tokens.user.token %}
                                <span class="badge bg-success ms-2">Token valide</span>
                            {% endif %}
                        {% else %}
                            <em class="text-muted">Non défini</em>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fonctionnalités disponibles -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-list-check"></i> Workflow d'envoi de documents
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 text-center mb-3">
                        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 60px; height: 60px;">
                            <i class="bi bi-info-circle text-primary fs-4"></i>
                        </div>
                        <h6>1. Informations</h6>
                        <small class="text-muted">Objet, message et mode de signature</small>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 60px; height: 60px;">
                            <i class="bi bi-file-earmark-pdf text-success fs-4"></i>
                        </div>
                        <h6>2. Document PDF</h6>
                        <small class="text-muted">Upload du fichier à signer</small>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 60px; height: 60px;">
                            <i class="bi bi-people text-warning fs-4"></i>
                        </div>
                        <h6>3. Signataires</h6>
                        <small class="text-muted">Ajout des personnes à faire signer</small>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="bg-info bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 60px; height: 60px;">
                            <i class="bi bi-send text-info fs-4"></i>
                        </div>
                        <h6>4. Envoi</h6>
                        <small class="text-muted">Finalisation et envoi des invitations</small>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('send_document_page') }}" class="btn btn-primary">
                        <i class="bi bi-arrow-right"></i> Commencer l'envoi d'un document
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Informations pour les utilisateurs non connectés -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle"></i> À propos de JeSignExpert
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="bi bi-shield-check text-success"></i> Signature électronique sécurisée</h6>
                        <p class="text-muted">Envoyez vos documents pour signature électronique avec une sécurité maximale et une validité juridique.</p>
                        
                        <h6><i class="bi bi-clock text-primary"></i> Gain de temps</h6>
                        <p class="text-muted">Finies les impressions, signatures manuscrites et envois postaux. Tout se fait en ligne rapidement.</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="bi bi-people text-warning"></i> Workflow simple</h6>
                        <p class="text-muted">Ajoutez plusieurs signataires, définissez l'ordre de signature et suivez l'avancement en temps réel.</p>
                        
                        <h6><i class="bi bi-check2-all text-info"></i> Traçabilité complète</h6>
                        <p class="text-muted">Chaque signature est horodatée et traçable pour une sécurité juridique optimale.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_scripts %}
<script>
// Supprimer les scripts de création de transaction
// Garder seulement les fonctions utiles si nécessaire
</script>
{% endblock %}